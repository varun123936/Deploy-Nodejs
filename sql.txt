CREATE TABLE HMS_USERS (
    ID BIGINT AUTO_INCREMENT PRIMARY KEY,
    USERNAME VARCHAR(100) NOT NULL,
    EMAIL VARCHAR(255) NOT NULL,
    PASSWORD_HASH VARCHAR(255) NOT NULL,
    CREATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    UPDATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
        ON UPDATE CURRENT_TIMESTAMP,
    CONSTRAINT UK_HMS_USERS_USERNAME UNIQUE (USERNAME),
    CONSTRAINT UK_HMS_USERS_EMAIL UNIQUE (EMAIL)
) ENGINE=InnoDB;


CREATE TABLE HMS_REFRESH_TOKENS (
  ID BIGINT AUTO_INCREMENT PRIMARY KEY,
  USER_ID BIGINT NOT NULL,
  TOKEN VARCHAR(500) NOT NULL UNIQUE,
  EXPIRES_AT TIMESTAMP NOT NULL,
  CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
  IS_REVOKED TINYINT DEFAULT 0 NOT NULL,
  CONSTRAINT FK_HMS_REFRESH_TOKENS_USER
    FOREIGN KEY (USER_ID) REFERENCES HMS_USERS(ID)
    ON DELETE CASCADE
) ENGINE=InnoDB;

-- Users table indexes
CREATE INDEX IDX_HMS_USERS_EMAIL
    ON HMS_USERS (EMAIL);

CREATE INDEX IDX_HMS_USERS_USERNAME
    ON HMS_USERS (USERNAME);

-- Refresh tokens table indexes
CREATE INDEX IDX_HMS_REFRESH_TOKENS_TOKEN
    ON HMS_REFRESH_TOKENS (TOKEN);

CREATE INDEX IDX_HMS_REFRESH_TOKENS_USER_ID
    ON HMS_REFRESH_TOKENS (USER_ID);

CREATE INDEX IDX_HMS_REFRESH_TOKENS_ACTIVE
    ON HMS_REFRESH_TOKENS (USER_ID, IS_REVOKED, EXPIRES_AT);

